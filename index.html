<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Home Assistant Dashboards</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background: black;
      color: white;
      font-family: Arial, sans-serif;
    }
    iframe {
      border: none;
      width: 100%;
      height: 100%;
    }
    #config-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      padding-top: 20px;
      z-index: 10;
      overflow-y: auto;
    }
    h1 { font-size: 32px; }
    input[type=text] {
      width: 80%;
      padding: 12px;
      margin: 10px 0;
      font-size: 24px;
    }
    .dashboard-entry {
      width: 80%;
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    .dashboard-entry input {
      flex: 1;
    }
    button.remove {
      background: #d80000;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 20px;
    }
    button#add-dashboard {
      padding: 12px 24px;
      font-size: 24px;
      background: #00add8;
      color: white;
      border: none;
      margin: 20px 0;
    }
    button#save-btn {
      padding: 15px 40px;
      font-size: 28px;
      background: #00d800;
      color: white;
      border: none;
    }
    #status {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 28px;
      background: rgba(0,0,0,0.6);
      padding: 10px 30px;
      border-radius: 10px;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div id="config-screen">
    <h1>Home Assistant Multi-Dashboard</h1>
    <p>Base URL (include http/https and port, no trailing slash):</p>
    <input type="text" id="base-url" placeholder="e.g. http://192.168.1.100:8123">

    <h2>Dashboards (up to 10)</h2>
    <div id="dashboards-list"></div>

    <button id="add-dashboard">+ Add Dashboard</button>
    <button id="save-btn">Save & Load First Dashboard</button>
  </div>

  <iframe id="ha-frame" src="" sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-top-navigation"></iframe>
  <div id="status">Dashboard 1: Loading...</div>

  <script>
    const baseUrlInput = document.getElementById('base-url');
    const dashboardsList = document.getElementById('dashboards-list');
    const addBtn = document.getElementById('add-dashboard');
    const saveBtn = document.getElementById('save-btn');
    const frame = document.getElementById('ha-frame');
    const configScreen = document.getElementById('config-screen');
    const status = document.getElementById('status');

    let dashboards = []; // [{name: "Main", path: "/lovelace"}]
    let currentIndex = 0;

    // Load saved data
    const savedBase = localStorage.getItem('haBaseUrl');
    const savedDashboards = localStorage.getItem('haDashboards');
    if (savedBase) baseUrlInput.value = savedBase;
    if (savedDashboards) {
      dashboards = JSON.parse(savedDashboards);
      renderDashboardList();
      loadDashboard(0);
    } else {
      addDashboardEntry(); // start with one empty
    }

    function renderDashboardList() {
      dashboardsList.innerHTML = '';
      dashboards.forEach((dash, idx) => {
        const div = document.createElement('div');
        div.className = 'dashboard-entry';
        div.innerHTML = `
          <input type="text" placeholder="Name (e.g. Main)" value="${dash.name || ''}">
          <input type="text" placeholder="Path (e.g. /lovelace or /lovelace-lights/0)" value="${dash.path || ''}">
          <button class="remove" onclick="removeDashboard(${idx})">Remove</button>
        `;
        dashboardsList.appendChild(div);
      });
    }

    function addDashboardEntry() {
      if (dashboards.length >= 10) return alert('Max 10 dashboards');
      dashboards.push({name: '', path: ''});
      renderDashboardList();
    }

    window.removeDashboard = function(idx) {
      dashboards.splice(idx, 1);
      renderDashboardList();
    };

    addBtn.onclick = addDashboardEntry;

    saveBtn.onclick = () => {
      const base = baseUrlInput.value.trim();
      if (!base) return alert('Enter base URL');

      // Collect from inputs
      const entries = dashboardsList.querySelectorAll('.dashboard-entry');
      dashboards = [];
      let valid = true;
      entries.forEach(entry => {
        const name = entry.querySelectorAll('input')[0].value.trim();
        const path = entry.querySelectorAll('input')[1].value.trim();
        if (name && path) {
          dashboards.push({name, path});
        } else if (name || path) {
          valid = false;
        }
      });

      if (!valid) return alert('Complete both fields for each dashboard');
      if (dashboards.length === 0) return alert('Add at least one dashboard');

      localStorage.setItem('haBaseUrl', base);
      localStorage.setItem('haDashboards', JSON.stringify(dashboards));

      loadDashboard(0);
    };

    function loadDashboard(idx) {
      if (idx < 0 || idx >= dashboards.length) return;
      currentIndex = idx;
      const base = localStorage.getItem('haBaseUrl');
      const url = base + dashboards[idx].path;
      frame.src = url;
      status.textContent = `Dashboard ${idx + 1}: ${dashboards[idx].name}`;
      configScreen.style.display = 'none';
    }

    // Arrow keys to switch dashboards
    document.addEventListener('keydown', (e) => {
      if (configScreen.style.display !== 'none') return;

      if (e.keyCode === 37) { // Left
        e.preventDefault();
        loadDashboard(currentIndex > 0 ? currentIndex - 1 : dashboards.length - 1);
      } else if (e.keyCode === 39) { // Right
        e.preventDefault();
        loadDashboard(currentIndex < dashboards.length - 1 ? currentIndex + 1 : 0);
      } else if (e.keyCode === 461 || e.keyCode === 8) { // Back
        e.preventDefault();
        configScreen.style.display = 'flex';
        frame.src = '';
        baseUrlInput.value = localStorage.getItem('haBaseUrl') || '';
        dashboards = JSON.parse(localStorage.getItem('haDashboards') || '[]');
        renderDashboardList();
      }
    });
  </script>
</body>
</html>